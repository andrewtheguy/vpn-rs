# tunnel-rs server configuration example
#
# Usage: tunnel-rs server -c server.toml
#        tunnel-rs server --default-config
#
# Mode is inferred from the 'mode' field below.
# CLI arguments take precedence over config file values.
#
# This file shows iroh mode. See commented sections below for other modes.

# Required: validates config matches CLI command
role = "server"
mode = "iroh"  # or "iroh-manual", "custom-manual", or "nostr"

# NOTE: For multi-source modes (iroh, nostr), do NOT set 'source' here.
# Clients request sources dynamically. Use allowed_sources below to restrict.

[iroh]
# Base64-encoded secret key for persistent identity (inline)
# secret = "base64..."
#
# Path to secret key file for persistent identity (use either secret or secret_file)
# Generate with: tunnel-rs generate-iroh-key --output server.key
# secret_file = "./server.key"

# Custom relay server URL(s) for failover
# If not provided, uses iroh's default public relays
relay_urls = [
    "https://relay1.example.com",
    "https://relay2.example.com",
]

# Custom DNS server URL for peer discovery
# Used with self-hosted iroh-dns-server for fully independent operation
# NOTE: URL must include the /pkarr path
# dns_server = "https://dns.example.com/pkarr"

# Maximum concurrent sessions (default: 100)
max_sessions = 100

# Allowed source networks that clients can request (CIDR notation)
# Clients MUST specify --source which must match one of these networks
# Separate lists for TCP and UDP protocols
# Supports IPv4 and IPv6 CIDR notation
[iroh.allowed_sources]
tcp = [
    "127.0.0.0/8",      # localhost
    "192.168.0.0/16",   # private network
    "::1/128",          # IPv6 localhost
]
udp = [
    "10.0.0.0/8",       # private network
]

# [iroh-manual]
# # Client-initiated mode: clients request sources, server validates
# # Set to [] to disable STUN entirely
# stun_servers = [
#     "stun.l.google.com:19302",
#     "stun1.l.google.com:19302",
#     "stun.services.mozilla.com:3478",
# ]
# # Allowed source networks that clients can request (CIDR notation)
# [iroh-manual.allowed_sources]
# tcp = ["127.0.0.0/8", "192.168.0.0/16"]
# udp = ["10.0.0.0/8"]

# [custom-manual]
# # Client-initiated mode: clients request sources, server validates
# # Set to [] to disable STUN entirely
# stun_servers = [
#     "stun.l.google.com:19302",
#     "stun1.l.google.com:19302",
#     "stun.services.mozilla.com:3478",
# ]
# # Allowed source networks that clients can request (CIDR notation)
# [custom-manual.allowed_sources]
# tcp = ["127.0.0.0/8", "192.168.0.0/16"]
# udp = ["10.0.0.0/8"]

# [nostr]
# # NOTE: For nostr mode, do NOT set 'source' above - clients request sources dynamically.
# # Use allowed_sources below to restrict what clients can request.
# # Server-only fields: allowed_sources, max_sessions
# # (request_source is client-only and will be rejected if present here)
#
# # Your Nostr private key (generate with: tunnel-rs generate-nostr-key)
# # Use either nsec or nsec_file
# nsec = "nsec1..."
# nsec_file = "./nostr.nsec"
#
# # Peer's Nostr public key
# peer_npub = "npub1..."
#
# # Nostr relay URLs (defaults to public relays if not specified)
# relays = [
#     "wss://relay.damus.io",
#     "wss://nos.lol",
#     "wss://relay.nostr.band",
#     "wss://relay.primal.net",
#     "wss://nostr.mom",
#     "wss://relay.snort.social",
# ]
#
# # Set to [] to disable STUN entirely
# stun_servers = [
#     "stun.l.google.com:19302",
#     "stun1.l.google.com:19302",
#     "stun.services.mozilla.com:3478",
# ]
#
# # Maximum concurrent sessions (server only, default: 10)
# max_sessions = 10
#
# # Allowed source networks that clients can request (server only, CIDR notation)
# # Clients MUST specify --source which must match one of these networks
# # Separate lists for TCP and UDP protocols
# # Supports IPv4 and IPv6 CIDR notation
# [nostr.allowed_sources]
# tcp = [
#     "127.0.0.0/8",      # localhost
#     "192.168.0.0/16",   # private network
#     "::1/128",          # IPv6 localhost
# ]
# udp = [
#     "10.0.0.0/8",       # private network
# ]
