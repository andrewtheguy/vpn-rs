# tunnel-rs server configuration example
#
# Usage: tunnel-rs server -c server.toml
#        tunnel-rs server --default-config
#
# Mode is inferred from the 'mode' field below.
# CLI arguments take precedence over config file values.
# This file is iroh-only. For ICE modes, see server_ice.toml.example.

# Required: validates config matches CLI command
role = "server"
mode = "iroh"

# NOTE: For iroh mode, do NOT set 'source' here.
# Clients request sources dynamically. Use allowed_sources below to restrict.

[iroh]
# Base64-encoded secret key for persistent identity (inline)
# secret = "base64..."
#
# Path to secret key file for persistent identity (use either secret or secret_file)
# Generate with: tunnel-rs generate-server-key --output server.key
# secret_file = "./server.key"

# Custom relay server URL(s) for failover
# If not provided, uses iroh's default public relays
relay_urls = [
    "https://relay1.example.com",
    "https://relay2.example.com",
]

# Custom DNS server URL for peer discovery, or "none" to disable DNS discovery.
# Used with self-hosted iroh-dns-server for fully independent operation.
# Set to "none" to disable DNS-based peer discovery (mDNS still works).
# NOTE: URL must include the /pkarr path
# dns_server = "https://dns.example.com/pkarr"
# dns_server = "none"

# Maximum concurrent sessions (default: 100)
max_sessions = 100

# ============================================================================
# Authentication (REQUIRED)
# ============================================================================
# Clients must provide one of these tokens to connect.
# Token format: exactly 18 characters (i + 16 body chars + checksum)
# Generate with: tunnel-rs generate-token

# Authentication tokens (inline list)
# NOTE: Use either auth_tokens OR auth_tokens_file, not both.
auth_tokens = [
    "iXXXXXXXXXXXXXXXXX",  # Replace with real tokens from generate-token
    # "iYYYYYYYYYYYYYYYYY",  # Add more tokens as needed
]

# Or use a file (one token per line, # comments allowed)
# NOTE: Use either auth_tokens OR auth_tokens_file, not both.
# auth_tokens_file = "/etc/tunnel-rs/auth_tokens.txt"

# ============================================================================
# Allowed source networks that clients can request (CIDR notation)
# Clients MUST specify --source which must match one of these networks
# Separate lists for TCP and UDP protocols
# Supports IPv4 and IPv6 CIDR notation
[iroh.allowed_sources]
tcp = [
    "127.0.0.0/8",      # localhost
    "192.168.0.0/16",   # private network
    "::1/128",          # IPv6 localhost
]
udp = [
    "10.0.0.0/8",       # private network
]

# ============================================================================
# Transport Tuning (Optional)
# ============================================================================
# Fine-tune QUIC transport layer for performance optimization.
# All values have sensible defaults - only configure if needed.

[iroh.transport]
# Congestion controller algorithm (default: cubic)
# - cubic: Loss-based, widely deployed, best for general internet
# - bbr: Model-based, may perform better on high-bandwidth/high-latency links
# - newreno: Classic TCP-like, most conservative
# congestion_controller = "cubic"

# QUIC receive window in bytes (default: 2097152 = 2MB)
# Controls flow control - larger values allow more in-flight data
# Valid range: 1024 (1KB) to 16777216 (16MB)
# receive_window = 2097152

# QUIC send window in bytes (default: 2097152 = 2MB)
# Controls how much data can be sent before acknowledgment
# Valid range: 1024 (1KB) to 16777216 (16MB)
# send_window = 2097152
