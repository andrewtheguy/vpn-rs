# Cargo configuration for embedded Tor builds (iroh mode only, no ICE modes)
#
# USAGE:
#   mv Cargo.toml Cargo.ice.toml
#   mv Cargo.tor.toml Cargo.toml
#   cargo build --release
#   mv Cargo.toml Cargo.tor.toml
#   mv Cargo.ice.toml Cargo.toml
#
# Or use the build script:
#   ./scripts/build-tor.sh

[package]
name = "tunnel-rs"
version = "0.1.23"
edition = "2021"
resolver = "2"
description = "TCP/UDP port forwarding through iroh P2P connections (embedded Tor build)"

[lib]
name = "tunnel_rs"
path = "src/lib.rs"

[[bin]]
name = "tunnel-rs"
path = "src/main.rs"

[features]
default = ["embedded-tor"]
test-utils = ["iroh/test-utils"]
embedded-tor = ["dep:arti-client", "dep:tor-rtcompat", "dep:safelog", "dep:rusqlite"]

[dependencies]
iroh = { version = "0.95.1", features = ["discovery-local-network"] }
tokio = { version = "1", features = ["full"] }
clap = { version = "4", features = ["derive"] }
anyhow = "1"
rand = "0.9"
base64 = "0.22"
serde = { version = "1", features = ["derive"] }
serde_json = "1"
crc32fast = "1"
toml = "0.8"
url = "2"
dirs = "6"
log = "0.4"
env_logger = "0.11"
tokio-socks = "0.5"
sha2 = "0.10"
ipnet = "2"
hex = "0.4"

# Arti (Tor) - for embedded Tor client
arti-client = { version = "0.37", features = ["onion-service-client", "tokio"], optional = true }
tor-rtcompat = { version = "0.37", features = ["tokio", "rustls"], optional = true }
safelog = { version = "0.7.1", optional = true }
rusqlite = { version = "0.37", features = ["bundled"], optional = true }
