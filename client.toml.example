# tunnel-rs client configuration example
#
# Usage: tunnel-rs client -c client.toml
#        tunnel-rs client --default-config
#        tunnel-rs-ice client ice-manual -c client.toml
#        tunnel-rs-ice client ice-nostr -c client.toml
#
# Mode is inferred from the 'mode' field below.
# CLI arguments take precedence over config file values.
#
# This file shows iroh mode. See commented sections below for other modes.

# Required: validates config matches CLI command
role = "client"
mode = "iroh"  # or "ice-manual", or "ice-nostr"

# All modes use client-initiated source requests with consistent config structure.
# Each mode section has request_source and target fields.

[iroh]
# NodeId of the server to connect to (required for iroh)
server_node_id = "2xnbkpbc7izsilvewd7c62w7wnwziacmpfwvhcrya5nt76dqkpga"

# ============================================================================
# Client Identity (RECOMMENDED for authentication)
# ============================================================================
# Generate with: tunnel-rs generate-iroh-key --output client.key
# Get NodeId with: tunnel-rs show-iroh-node-id --secret-file client.key
# Share your NodeId with the server admin to be added to allowed_clients
secret_file = "./client.key"

# Source address to request from server (REQUIRED for iroh mode)
# Must be in server's allowed_sources list (--allowed-tcp or --allowed-udp)
request_source = "tcp://127.0.0.1:22"

# Local address to listen on (REQUIRED for iroh mode)
target = "127.0.0.1:2222"

# Custom relay server URL(s) for failover
# Must match the server's relay configuration
relay_urls = [
    "https://relay1.example.com",
    "https://relay2.example.com",
]

# Custom DNS server URL for peer discovery
# Must match the server's dns_server configuration
# NOTE: URL must include the /pkarr path
# dns_server = "https://dns.example.com/pkarr"

# [Experimental] SOCKS5 proxy for relay connections
# Tor support is experimental and might not work reliably.
# REQUIRED: If relay_urls contain .onion addresses, MUST use socks5h:// for DNS through proxy
# OPTIONAL: For non-.onion relays, can use socks5:// or socks5h://
# Use with Tor: socks5h://127.0.0.1:9050
# socks5_proxy = "socks5h://127.0.0.1:9050"

# [ice-manual]
# # Client-initiated mode: request source from server, listen locally
# # Source address to request from server (REQUIRED)
# request_source = "tcp://127.0.0.1:22"
# # Local address to listen on (REQUIRED)
# target = "127.0.0.1:2222"
# # Set to [] to disable STUN entirely
# stun_servers = [
#     "stun.l.google.com:19302",
#     "stun1.l.google.com:19302",
#     "stun.services.mozilla.com:3478",
# ]

# [ice-nostr]
# # Your Nostr private key (generate with: tunnel-rs-ice generate-nostr-key)
# # Use either nsec or nsec_file (mutually exclusive; config validation will error if both are set)
# # If using nsec_file, keep permissions tight (e.g., chmod 600) and do not commit to VCS.
# # Relative paths are resolved from the process working directory, not the config file location.
# nsec = "nsec1..."
# nsec_file = "./nostr.nsec"
#
# # Peer's Nostr public key
# peer_npub = "npub1..."
#
# # Nostr relay URLs (defaults to public relays if not specified)
# relays = [
#     "wss://relay.damus.io",
#     "wss://nos.lol",
#     "wss://relay.nostr.band",
#     "wss://relay.primal.net",
#     "wss://nostr.mom",
#     "wss://relay.snort.social",
# ]
#
# # Set to [] to disable STUN entirely
# stun_servers = [
#     "stun.l.google.com:19302",
#     "stun1.l.google.com:19302",
#     "stun.services.mozilla.com:3478",
# ]
#
# # Source address to request from server (REQUIRED for ice-nostr mode)
# # Must be in server's allowed_sources list (--allowed-tcp or --allowed-udp)
# # Can also use 'source' as an alias
# request_source = "tcp://127.0.0.1:22"
#
# # Local address to listen on (REQUIRED for ice-nostr mode)
# target = "127.0.0.1:2222"
