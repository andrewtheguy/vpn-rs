# tunnel-rs-ice server configuration example (ICE modes)
#
# Usage: tunnel-rs-ice server -c server_ice.toml
#        tunnel-rs-ice server --default-config
#
# Mode is inferred from the 'mode' field below.
# CLI arguments take precedence over config file values.
#
# This file is ICE-only. For iroh mode, see server.toml.example.

# Required: validates config matches CLI command
role = "server"
mode = "manual"  # or "nostr"

# NOTE: For multi-source modes (nostr), do NOT set 'source' here.
# Clients request sources dynamically. Use allowed_sources below to restrict.

[manual]
# Client-initiated mode: clients request sources, server validates
# Set to [] to disable STUN entirely
stun_servers = [
    "stun.l.google.com:19302",
    "stun1.l.google.com:19302",
]
# Allowed source networks that clients can request (CIDR notation)
[manual.allowed_sources]
tcp = ["127.0.0.0/8", "192.168.0.0/16"]
udp = ["10.0.0.0/8"]
# Transport tuning (QUIC). Defaults are optimized for throughput on LAN/loopback.
# [manual.transport]
# congestion_controller = "cubic"  # or "bbr", "newreno"
# receive_window = 8388608
# send_window = 8388608

# [nostr]
# Do NOT set 'source' above - clients request sources dynamically.
# Use allowed_sources below to restrict what clients can request.
# Server-only fields: allowed_sources, max_sessions
# (request_source is client-only and will be rejected if present here)
#
# Your Nostr private key (generate with: tunnel-rs-ice generate-nostr-key)
# Use either nsec or nsec_file
# nsec = "nsec1..."
# nsec_file = "./nostr.nsec"
#
# Peer's Nostr public key
# peer_npub = "npub1..."
#
# Nostr relay URLs (defaults to public relays if not specified)
# relays = [
#     "wss://relay.damus.io",
#     "wss://nos.lol",
#     "wss://relay.primal.net",
#     "wss://nostr.mom",
#     "wss://relay.snort.social",
# ]
#
# Set to [] to disable STUN entirely
# stun_servers = [
#     "stun.l.google.com:19302",
#     "stun1.l.google.com:19302",
# ]
#
# Maximum concurrent sessions (server only, default: 10)
# max_sessions = 10
#
# Transport tuning (QUIC). Defaults are optimized for throughput on LAN/loopback.
# [nostr.transport]
# congestion_controller = "cubic"  # or "bbr", "newreno"
# receive_window = 8388608
# send_window = 8388608
#
# Allowed source networks that clients can request (server only, CIDR notation)
# Clients MUST specify --source which must match one of these networks
# Separate lists for TCP and UDP protocols
# Supports IPv4 and IPv6 CIDR notation
# [nostr.allowed_sources]
# tcp = [
#     "127.0.0.0/8",      # localhost
#     "192.168.0.0/16",   # private network
#     "::1/128",          # IPv6 localhost
# ]
# udp = [
#     "10.0.0.0/8",       # private network
# ]
